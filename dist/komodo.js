!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("antd"),require("lodash"),require("axios"),require("react-redux")):"function"==typeof define&&define.amd?define(["react","antd","lodash","axios","react-redux"],t):"object"==typeof exports?exports.Komodo=t(require("react"),require("antd"),require("lodash"),require("axios"),require("react-redux")):e.Komodo=t(e.React,e.antd,e._,e.axios,e.ReactRedux)}(window,(function(e,t,r,n,o){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t,r){"use strict";r.r(t),r.d(t,"api",(function(){return b})),r.d(t,"setupApi",(function(){return d})),r.d(t,"KctSelect",(function(){return C})),r.d(t,"KctUpload",(function(){return N}));var n=r(0),o=r.n(n),a=r(3),i=r.n(a),u=r(1);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p={apiBaseUrl:"http://127.0.0.1:8000/api",wafEnabled:!1,authorization:null,session:null,storage:null,sentry:null,history:null},d=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,r=Object.entries(e);t<r.length;t++){var n=s(r[t],2),o=n[0],a=n[1];["authorization","session"].includes(o)||(p[o]=a)}},m=i.a.create({baseURL:p.apiBaseUrl,headers:{"Content-Type":"application/json"}}),g=function(){p.storage.save("session",{}),p.authorization=null,"/auth/login"!==p.history.location.pathname&&p.history.replace("/auth/login")};m.defaults.xsrfCookieName="csrftoken",m.defaults.xsrfHeaderName="X-CSRFToken",m.interceptors.request.use((function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e.headers.common);if(!p.authorization){var r=p.storage.load("session").accessToken;p.authorization=r}if(p.authorization&&(t.Authorization="Token "+p.authorization),!p.session){var n=p.storage.load("settings").session;p.session=n}return p.session&&(t["X-Session"]=p.session),e.headers.common=t,p.wafEnabled&&("put"===e.method?(e.method="post",e.url+="/edit"):"delete"===e.method?(e.method="post",e.url+="/remove"):"patch"===e.method&&(e.method="post",e.url+="/partial_edit")),e})),m.interceptors.response.use((function(e){if(e.data instanceof Blob)return e;var t=e.status,r=e.data,n=r.success,a=r.status,i=r.message,l=void 0===i?"":i,c=r.data,s=void 0===c?{}:c,f=r.count,d=r.total,m=r.page,b=r.pages;return n||204===t||(void 0!==l&&(p.sentry.captureException(l),u.notification.error({message:"Error",description:o.a.createElement(o.a.Fragment,null,l.split("\n").map((function(e,t){return o.a.createElement(o.a.Fragment,{key:t},e,o.a.createElement("br",null))})))})),401===a&&g()),e.message=l,e.success=n,e.statusCode=void 0!==a?a:t,e.data=s,e.count=f,e.total=d,e.page=m,e.pages=b,e}),(function(e){if(e.response)switch(e.response.status){case 401:u.notification.error({message:"Error",description:"Token expired !"}),g();break;case 403:u.notification.error({message:"Forbidden !",description:"You are not allowed to access this API !"});break;default:p.sentry.captureException(e),u.notification.error({message:"Error",description:"Application encountered an error. Don't worry, we've notified about this."})}else e.request?(p.sentry.captureException(e),u.notification.error({message:"Server Error",description:"Application server encountered an error. Don't worry, we've notified about this."})):(p.sentry.captureException(e),u.notification.error({message:"Request Error",description:"Application encountered an error. Don't worry, we've notified about this."}));return Promise.reject(e)})),m.configure=function(){var e=p.storage.load("session").accessToken,t=p.storage.load("config").session;p.authorization=e,p.session=t},m.download=function(e,t){return m.post(e,t,{responseType:"blob"}).then((function(e){var t=e.headers["content-disposition"].split("filename=")[1],r=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=r,n.setAttribute("download",t),document.body.appendChild(n),n.click()}))};var b=m,y=r(2);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function E(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var P=u.Select.Option,x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={params:t};return void 0!==r.params.filters&&(r.params.filters=JSON.stringify(r.params.filters)),void 0!==r.params.fields&&(r.params.fields=JSON.stringify(r.params.fields)),void 0!==r.params.search&&(r.params.search=JSON.stringify(r.params.search)),b.get(e,r).then((function(e){var t=e.data,r=void 0===t?[]:t,n=e.total,o=void 0===n?0:n,a=e.pages,i=void 0===a?0:a,u=e.page;return{items:r,total:o,pages:i,page:void 0===u?0:u}}))},A=function(){return o.a.createElement("div",{style:{textAlign:"center",paddingTop:"16px"}},o.a.createElement(u.Spin,{size:"small"}))},k=o.a.forwardRef((function(e,t){var r=e.url,a=e.children,i=e.onChange,l=e.onSelectModel,c=e.onChangeModel,s=e.defaultValue,f=e.value,p=void 0===f?s:f,d=e.defaultParams,m=(d=void 0===d?{}:d).start,g=void 0===m?0:m,b=d.limit,h=void 0===b?10:b,j=E(d,["start","limit"]),S=e.itemLabelPath,k=void 0===S?"label":S,C=e.itemValuePath,T=void 0===C?"value":C,D=e.itemQueryPath,I=void 0===D?k:D,R=e.itemRenderer,q=E(e,["url","children","onChange","onSelectModel","onChangeModel","defaultValue","value","defaultParams","itemLabelPath","itemValuePath","itemQueryPath","itemRenderer"]),M={start:g,limit:h,total:0,pages:0,page:0},U=w(Object(n.useState)(!1),2),z=U[0],F=U[1],L=w(Object(n.useState)(!0),2),V=L[0],_=L[1],N=w(Object(n.useState)(!1),2),K=N[0],B=N[1],J=w(Object(n.useState)(!1),2),$=J[0],Q=J[1],X=w(Object(n.useState)(null),2),H=X[0],Y=X[1],G=w(Object(n.useState)({items:[],paging:O({},M)}),2),W=G[0],Z=G[1],ee=w(Object(n.useState)({items:[],paging:O({},M)}),2),te=ee[0],re=ee[1],ne=w(Object(n.useState)({items:[],paging:O({},M)}),2),oe=ne[0],ae=ne[1],ie=Object(n.useRef)();Object(n.useEffect)((function(){var e=!0;if(B(!0),r)if(V)if(p){var t="all"!==oe.paging.limit?{filters:[{field:T,value:Array.isArray(p)?p:[p],op:"in"}],start:oe.paging.start,limit:oe.paging.limit}:{};x(r,t).then((function(t){var r=t.items,n=t.total,o=t.pages,a=t.page,i=O(O({},oe.paging),{},{total:n,pages:o,page:a});e&&(ae({items:r,paging:i}),B(!1))})).catch((function(e){B(!1)}))}else B(!1);else B(!1);else B(!1);return function(){e=!1}}),[p,V]),Object(n.useEffect)((function(){r&&_(!0)}),[r]),Object(n.useEffect)((function(){Object(y.isEqual)(j,ie.current)||_(!0)}),[j]),Object(n.useEffect)((function(){ie.current=j}));var ue=Object(y.debounce)((function(e){if(r&&"all"!==te.paging.limit){F(!0),Y(e);var t=te.paging.limit,n=O(O({},j),{},{start:0,limit:t});e&&(n.fields=[I],n.search=[e]),Q(!0),x(r,n).then((function(e){var t=e.items,r=e.total,n=e.pages,o=e.page,a=O(O({},te.paging),{},{start:0,total:r,pages:n,page:o});re({items:t,paging:a}),ae({items:t,paging:a}),Q(!1)}))}}),500),le=function(e,t){var n=e*t-t,o=t,a=O(O({},j),{},{start:n,limit:o});z&&H&&(a.fields=[I],a.search=[H]),Q(!0),x(r,a).then((function(e){var t=e.items,r=e.total,a=e.pages,i=e.page,u={start:n,limit:o,total:r,pages:a,page:i};z?(u=O(O({},te.paging),u),re({items:t,paging:u})):(u=O(O({},W.paging),u),Z({items:t,paging:u})),ae({items:t,paging:u}),Q(!1)}))},ce=r?oe.items.map((function(e){var t=R?R(e):e[k];return o.a.createElement(P,{key:e[T],value:e[T],label:e[k],model:O({},e)},t)})):(a||[]).map((function(e){var t={},r=e.props,n=r.children,a=E(r,["children"]);return void 0!==e.props.model?t.model=e.props.model:t.model=a,void 0===e.props.label&&(t.label=n),o.a.cloneElement(e,O({},t))})),se=!0;r?"all"===oe.paging.limit&&(se=!1):se=!1;var fe=!se&&function(e,t){return t.props.children.toLowerCase().includes(e.toLowerCase())},pe=se?"value":"children";if(K)return o.a.createElement(u.Select,v({key:"fake",ref:t},q,{loading:!0}));var de=void 0===s?void 0===i?{defaultValue:p}:{value:p}:{defaultValue:p};return o.a.createElement(u.Select,v({ref:t,key:"orig",showSearch:!0,allowClear:!0},q,de,{filterOption:fe,optionFilterProp:pe,defaultActiveFirstOption:!1,notFoundContent:$?o.a.createElement(A,null):null,onSearch:ue,onChange:function(e,t){if(void 0===e&&_(!0),i&&i(e),c)if(t){var r=Array.isArray(t)?t.map((function(e){return e.props.model})):t.props.model;c(r)}else c(t)},onSelect:function(e,t){l&&l(t.props.model)},onDropdownVisibleChange:function(e){if(r)if(e)if(V){_(!1);var t=O(O({},j),{},{start:W.paging.start,limit:W.paging.limit});Q(!0),x(r,t).then((function(e){var t=e.items,r=e.total,n=e.pages,o=e.page,a=O(O({},W.paging),{},{total:r,pages:n,page:o});Z({items:t,paging:a}),ae({items:t,paging:a}),Q(!1)}))}else{var n=W.items,o=W.paging;ae({items:n,paging:o})}else z&&_(!0),F(!1)},dropdownRender:function(e){return o.a.createElement("div",null,$?o.a.createElement(A,null):e,o.a.createElement("div",{hidden:oe.paging.pages<2},o.a.createElement(u.Divider,{style:{margin:"4px 0"}}),o.a.createElement("div",{style:{textAlign:"center",padding:"2px"},onMouseDown:function(e){return e.preventDefault()}},"all"!==oe.paging.limit?o.a.createElement(u.Pagination,{onChange:le,size:"small",current:oe.paging.page,pageSize:oe.paging.limit,total:oe.paging.total}):null)))}}),ce)}));k.name=k.displayName="KctSelect",k.Option=P;var C=k,T=r(4);function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function I(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||F(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){M(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function U(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(e,t)||F(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){if(e){if("string"==typeof e)return L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?L(e,t):void 0}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var V=window.MIME_VALIDATOR||{},_=function(e){if(e&&/^http/.test(e))try{return new URL(e).pathname.split("/").pop()}catch(e){}return e},N=o.a.forwardRef((function(e,t){var r,a=Object(n.useRef)(),i=Object(T.useSelector)((function(e){return e.session})).accessToken,l=z(Object(n.useState)([]),2),c=l[0],s=l[1],f=e.children,p=e.url,d=e.value,m=e.fileItem,g=void 0===m?{}:m,y=e.mimeValidator,v=e.headers,h=void 0===v?{}:v,O=e.allowedTypes,j=e.onChange,w=void 0===j?function(){}:j,S=e.onFileChange,E=U(e,["children","url","value","fileItem","mimeValidator","headers","allowedTypes","onChange","onFileChange"]);r=void 0!==y?V[y]||[]:O||[],Object(n.useEffect)((function(){t&&("function"==typeof t?t(a.current):t.current=a.current)}));var P=g.name,x=function(){var e=g.name,t=g.uid,r=void 0===t?e:t,n=g.status,o=void 0===n?"done":n,a=U(g,["name","uid","status"]);if(e){var i=q({uid:r,name:_(e),status:o},a);s([i])}};Object(n.useEffect)((function(){P&&x()}),[P]),Object(n.useEffect)((function(){var e=!1,t=g.name;p?t===d&&(e=!0):void 0===d&&(e=!0),e&&x()}),[d]);var A=function(e){var t=e.type,n=e.name;return!(r.length&&!r.includes(t))||(u.notification.error({duration:8,message:"Invalid File Type",description:o.a.createElement("span",null,'The specified file "',o.a.createElement("b",null,n),'" could not be uploaded. File is invalid, or not supported. Allowed types:',o.a.createElement("ul",null,r.map((function(e,t){return o.a.createElement("li",{key:t},e)}))))}),!1)},k=q({},E);return r.length&&(k.accept=r.join(",")),void 0===p?(k.onRemove=function(e){s((function(t){var r=I(t),n=r.findIndex((function(t){return t.uid===e.uid}));return r.splice(n,1),r})),w("")},k.beforeUpload=function(e){return A(e)&&(s((function(t){return[e]})),w(e)),!1}):(k.action=b.defaults.baseURL+p,k.headers=q(q({},h),{},{authorization:"Token "+i}),k.beforeUpload=function(e){return!!A(e)},k.onChange=function(e){var t=e.file,r=t.status;if(void 0!==r)switch(r){case"done":var n=t.response.data,o=n.file,a=n.url,i=_(o),u=q(q({},t),{},{name:i,url:a});s([u]),w(u.name);break;case"removed":s([]),w("");break;default:case"uploading":s([t]),w(t.name)}}),Object(n.useEffect)((function(){var e=c.length?c[0]:null;S&&S(e)}),[c]),o.a.createElement(u.Upload,D({ref:a},k,{fileList:c}),f)}))}])}));